{% extends 'base.html' %}

{% block extra_head %}
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">

    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.5.0/css/all.min.css">
{% endblock %}

{% block content %}
<main class="dashboard-container">
    
    <header class="welcome-header fade-in-item">
        <h1><i class="fa-solid fa-hand-wave" aria-hidden="true"></i> Olá, {{ request.user.username }}!</h1>
        <p>Bem-vindo ao seu painel de torcedor. O que vamos fazer hoje?</p>
    </header>

    <section class="quick-actions-grid">
        
        <a href="{% url 'core:registrar_partida' %}" class="action-card card-destaque fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon"><i class="fa-solid fa-stadium" aria-hidden="true"></i></div>
                <h3>Registrar Nova Partida</h3>
                <p>Anote os detalhes do jogo que você assistiu.</p>
            </div>
        </a>
        
        <a href="{% url 'core:lista_partidas' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon"><i class="fa-solid fa-chart-simple" aria-hidden="true"></i></div>
                <h3>Histórico de Jogos</h3>
                <p>Veja e avalie suas partidas anteriores.</p>
            </div>
        </a>

        <a href="{% url 'core:avaliacao_inicio' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon"><i class="fa-solid fa-star" aria-hidden="true"></i></div>
                <h3>Avaliar Estádio</h3>
                <p>Conte como foi sua experiência na arquibancada.</p>
            </div>
        </a>

        <a href="{% url 'core:galeria' %}" class="action-card fade-in-item tilt-card">
            <div class="card-content-wrapper">
                <div class="card-icon"><i class="fa-solid fa-camera-retro" aria-hidden="true"></i></div>
                <h3>Galeria de Mídia</h3>
                <p>Reveja suas fotos e vídeos dos jogos.</p>
            </div>
        </a>
    </section>

    <section class="stats-panel fade-in-item">
        <h2>Suas Estatísticas</h2>
        <div class="stats-grid">
            
            <div class="stat-item">
                <span class="stat-number" data-value="{{ partidas_registradas }}">0</span>
                <span class="stat-label">Partidas Registradas</span>
            </div>
            
            <div class="stat-item">
                <span class="stat-number" data-value="{{ estadios_avaliados }}">0</span>
                <span class="stat-label">Estádios Avaliados</span>
            </div>

            <div class="stat-item">
                {% if time_favorito %}
                    <span class="stat-number stat-team">{{ time_favorito }}</span>
                {% else %}
                    <span class="stat-number">--</span>
                {% endif %}
                <span class="stat-label">Seu Time do Coração</span>
            </div>

        </div>
    </section>

</main>

<style>
    /* --- Variáveis de Estilo --- */
    :root {
        --card-bg: #ffffff;
        --text-primary: #1d2d35;
        --text-secondary: #657786;
        --border-color: #e1e8ed;
        --shadow-color: rgba(0, 0, 0, 0.08);
        --destaque-color: #007bff;
        --destaque-hover: #0056b3;
    }

    .dashboard-container {
        max-width: 1100px;
        margin: 0 auto;
        padding: 1rem;
        font-family: 'Poppins', sans-serif;
    }

    .fade-in-item {
        opacity: 0;
        transform: translateY(20px);
        transition: opacity 0.6s ease-out, transform 0.6s ease-out;
    }
    .fade-in-item.is-visible {
        opacity: 1;
        transform: translateY(0);
    }

    .welcome-header {
        padding: 1.5rem 1rem;
        border-radius: 12px;
        background-color: var(--card-bg);
        box-shadow: 0 4px 15px var(--shadow-color);
        margin-bottom: 2rem;
    }
    .welcome-header h1 { margin: 0 0 0.25rem 0; color: var(--text-primary); font-size: 2rem; font-weight: 700; display:flex; align-items:center; gap:0.5rem; }
    .welcome-header p { margin: 0; color: var(--text-secondary); font-size: 1.1rem; }

    .quick-actions-grid {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
        gap: 1.5rem;
        margin-bottom: 2rem;
        perspective: 1000px;
    }

    .action-card {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        text-decoration: none;
        color: var(--text-primary);
        box-shadow: 0 4px 15px var(--shadow-color);
        border: 1px solid var(--border-color);
        transform-style: preserve-3d;
        transition: transform 0.4s cubic-bezier(0.23, 1, 0.32, 1), box-shadow 0.4s cubic-bezier(0.23, 1, 0.32, 1);
    }

    .action-card:hover { box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15); }

    .card-content-wrapper { transform: translateZ(20px); }

    /* Ícones dos cards */
    .card-icon { font-size: 2.2rem; margin-bottom: 0.5rem; color: var(--destaque-color); display:flex; align-items:center; justify-content:flex-start; }
    .card-icon i { font-size: 2.2rem; }

    .action-card h3 { margin: 0 0 0.5rem 0; font-size: 1.2rem; font-weight: 600; }
    .action-card p { margin: 0; color: var(--text-secondary); font-size: 0.9rem; line-height: 1.4; }

    .action-card.card-destaque {
        background-color: var(--destaque-color);
        color: white;
        border-color: var(--destaque-color);
    }
    .action-card.card-destaque h3 { color: white; }
    .action-card.card-destaque p { color: #e0e0e0; }
    .action-card.card-destaque:hover { background-color: var(--destaque-hover); }

    /* Garante ícone branco no card destaque */
    .action-card.card-destaque .card-icon i { color: #fff; }

    .stats-panel {
        background-color: var(--card-bg);
        border-radius: 12px;
        padding: 1.5rem;
        box-shadow: 0 4px 15px var(--shadow-color);
    }
    .stats-panel h2 { margin: 0 0 1.5rem 0; color: var(--text-primary); font-weight: 600; border-bottom: 1px solid var(--border-color); padding-bottom: 0.5rem; }
    .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; }
    .stat-item { display: flex; flex-direction: column; align-items: center; text-align: center; padding: 1rem; background-color: #f9fafb; border-radius: 8px; }
    
    .stat-number {
        font-size: 2.25rem;
        font-weight: 700;
        color: var(--destaque-color);
        line-height: 1;
        font-variant-numeric: tabular-nums;
    }

    .stat-label { color: var(--text-secondary); font-size: 0.9rem; margin-top: 0.5rem; }
    .stat-team { font-size: 1.5rem; color: var(--text-primary); }

</style>


<script>
    document.addEventListener('DOMContentLoaded', () => {

        const animatedItems = document.querySelectorAll('.fade-in-item');
        animatedItems.forEach((item, index) => {
            setTimeout(() => { item.classList.add('is-visible'); }, index * 150 + 100);
        });

        const counters = document.querySelectorAll('.stat-number[data-value]');
        const animationDuration = 1500;
        const animateCounter = (counter) => {
            const targetValue = parseInt(counter.dataset.value, 10);
            if (isNaN(targetValue) || targetValue === 0) {
                counter.textContent = targetValue;
                return;
            }
            let startTime = null;
            const step = (timestamp) => {
                if (!startTime) startTime = timestamp;
                const progress = Math.min((timestamp - startTime) / animationDuration, 1);
                const easeOutProgress = 1 - Math.pow(1 - progress, 3);
                const currentValue = Math.floor(easeOutProgress * targetValue);
                counter.textContent = currentValue;
                if (progress < 1) { window.requestAnimationFrame(step); } else { counter.textContent = targetValue; }
            };
            window.requestAnimationFrame(step);
        };
        counters.forEach(animateCounter);

        const tiltCards = document.querySelectorAll('.tilt-card');
        tiltCards.forEach(card => {
            const maxTilt = 15;
            card.addEventListener('mousemove', (e) => {
                const rect = card.getBoundingClientRect();
                const cardWidth = card.offsetWidth;
                const cardHeight = card.offsetHeight;
                const mouseX = (e.clientX - rect.left - cardWidth / 2) / (cardWidth / 2);
                const mouseY = (e.clientY - rect.top - cardHeight / 2) / (cardHeight / 2);
                const rotateX = -maxTilt * mouseY;
                const rotateY = maxTilt * mouseX;
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale(1.05)`;
            });
            card.addEventListener('mouseleave', () => {
                card.style.transform = 'perspective(1000px) rotateX(0deg) rotateY(0deg) scale(1)';
            });
        });

    });
</script>

{% endblock %}
